(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1089:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>d,A:()=>u});var o=t(5155),s=t(2115),a=t(5647);let l="https://xqdlbbwavnmkewvjaget.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxZGxiYndhdm5ta2V3dmphZ2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwOTUxNjksImV4cCI6MjA2ODY3MTE2OX0.MRfDvIbM8zOEwTj6muzZTzeNwWoQ-TfjzExjMIabLs4";if(!l)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!n)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let i=(0,a.UU)(l,n,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),c=(0,s.createContext)(void 0),u=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:r}=e,[t,a]=(0,s.useState)(null),[l,n]=(0,s.useState)(null),[u,d]=(0,s.useState)(null),[_,f]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),[p,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{i.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;n(t),a(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),(null==t?void 0:t.user)&&(v(t.user.id),y(t.user.id)),h(!1)});let{data:{subscription:e}}=i.auth.onAuthStateChange(async(e,r)=>{var t;n(r),a(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?(await v(r.user.id),await y(r.user.id),"SIGNED_IN"!==e||u||g(!0)):(d(null),f(null),g(!1)),h(!1)});return()=>e.unsubscribe()},[]);let v=async e=>{try{let{data:r,error:t}=await i.from("profiles").select("*").eq("id",e).single();if(t&&"PGRST116"!==t.code){console.error("Error loading profile:",t);return}d(r)}catch(e){console.error("Error loading profile:",e)}},y=async e=>{try{let{data:r,error:t}=await i.from("practice_results").select("score, accuracy, total_time_seconds").eq("session_id",e);t&&console.log("No stats yet, using defaults:",t);let o=r&&r.length>0?{total_sessions:r.length,total_practice_time:r.reduce((e,r)=>e+r.total_time_seconds,0),letters_completed:[],average_accuracy:r.reduce((e,r)=>e+r.accuracy,0)/r.length,current_streak:0,best_streak:0,total_points:r.reduce((e,r)=>e+r.score,0),level:Math.floor(r.reduce((e,r)=>e+r.score,0)/100)+1}:{total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1};f(o),console.log("Stats loaded successfully:",o)}catch(e){console.error("Error loading stats:",e),f({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1})}},E=async(e,r)=>{try{var t;console.log("Attempting login for:",e);let{data:o,error:s}=await i.auth.signInWithPassword({email:e,password:r});if(s){if(console.error("Login error:",s),s.message.includes("Email not confirmed"))return console.error("Email needs confirmation"),{error:{...s,message:"Confirma tu email antes de iniciar sesi\xf3n"}};if(s.message.includes("Invalid login credentials"))return console.error("Invalid credentials"),{error:{...s,message:"Email o contrase\xf1a incorrectos"}};return{error:s}}return console.log("Login successful:",null===(t=o.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Unexpected login error:",e),{error:e}}},b=async(e,r,t,o,s)=>{try{let{data:a,error:l}=await i.auth.signUp({email:e,password:r,options:{data:{username:t,full_name:o,experience_level:s}}});if(l)return console.error("Auth signup error:",l),{error:l};if(!a.user)return console.error("No user data returned"),{error:Error("No user data returned")};let{error:n}=await i.from("profiles").insert({id:a.user.id,username:t,full_name:o,experience_level:s});if(n){if(console.error("Error creating profile:",n),"42P01"===n.code)return console.error("La tabla profiles no existe. Ejecuta el schema de Supabase."),{error:Error("Database not configured. Please contact support.")};return{error:n}}return console.log("User and profile created successfully"),{error:null}}catch(e){return console.error("Unexpected signup error:",e),{error:e}}},I=async()=>{let{error:e}=await i.auth.signOut();e&&console.error("Error signing out:",e)},w=async e=>{if(!t)return{error:Error("No user logged in")};try{let{error:r}=await i.from("profiles").update(e).eq("id",t.id);return r||d(r=>r?{...r,...e}:null),{error:r}}catch(e){return{error:e}}},S=async()=>{t&&await y(t.id)};return(0,o.jsx)(c.Provider,{value:{user:t,session:l,profile:u,stats:_,loading:m,signIn:E,signUp:b,signOut:I,updateProfile:w,refreshStats:S,isNewUser:p},children:r})}},2820:(e,r,t)=>{Promise.resolve().then(t.bind(t,1089)),Promise.resolve().then(t.t.bind(t,5688,23)),Promise.resolve().then(t.t.bind(t,9432,23)),Promise.resolve().then(t.t.bind(t,9324,23))},5688:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},9324:()=>{},9432:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{var r=r=>e(e.s=r);e.O(0,[261,647,441,684,358],()=>r(2820)),_N_E=e.O()}]);