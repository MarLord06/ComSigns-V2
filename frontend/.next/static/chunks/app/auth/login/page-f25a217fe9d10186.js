(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{1089:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>u,A:()=>d});var s=t(5155),a=t(2115),l=t(5647);let i="https://xqdlbbwavnmkewvjaget.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxZGxiYndhdm5ta2V3dmphZ2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwOTUxNjksImV4cCI6MjA2ODY3MTE2OX0.MRfDvIbM8zOEwTj6muzZTzeNwWoQ-TfjzExjMIabLs4";if(!i)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!n)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let o=(0,l.UU)(i,n,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),c=(0,a.createContext)(void 0),d=()=>{let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:r}=e,[t,l]=(0,a.useState)(null),[i,n]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(!0),[f,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;n(t),l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),(null==t?void 0:t.user)&&(v(t.user.id),b(t.user.id)),p(!1)});let{data:{subscription:e}}=o.auth.onAuthStateChange(async(e,r)=>{var t;n(r),l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?(await v(r.user.id),await b(r.user.id),"SIGNED_IN"!==e||d||g(!0)):(u(null),h(null),g(!1)),p(!1)});return()=>e.unsubscribe()},[]);let v=async e=>{try{let{data:r,error:t}=await o.from("profiles").select("*").eq("id",e).single();if(t&&"PGRST116"!==t.code){console.error("Error loading profile:",t);return}u(r)}catch(e){console.error("Error loading profile:",e)}},b=async e=>{try{let{data:r,error:t}=await o.from("practice_results").select("score, accuracy, total_time_seconds").eq("session_id",e);t&&console.log("No stats yet, using defaults:",t);let s=r&&r.length>0?{total_sessions:r.length,total_practice_time:r.reduce((e,r)=>e+r.total_time_seconds,0),letters_completed:[],average_accuracy:r.reduce((e,r)=>e+r.accuracy,0)/r.length,current_streak:0,best_streak:0,total_points:r.reduce((e,r)=>e+r.score,0),level:Math.floor(r.reduce((e,r)=>e+r.score,0)/100)+1}:{total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1};h(s),console.log("Stats loaded successfully:",s)}catch(e){console.error("Error loading stats:",e),h({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1})}},y=async(e,r)=>{try{var t;console.log("Attempting login for:",e);let{data:s,error:a}=await o.auth.signInWithPassword({email:e,password:r});if(a){if(console.error("Login error:",a),a.message.includes("Email not confirmed"))return console.error("Email needs confirmation"),{error:{...a,message:"Confirma tu email antes de iniciar sesi\xf3n"}};if(a.message.includes("Invalid login credentials"))return console.error("Invalid credentials"),{error:{...a,message:"Email o contrase\xf1a incorrectos"}};return{error:a}}return console.log("Login successful:",null===(t=s.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Unexpected login error:",e),{error:e}}},w=async(e,r,t,s,a)=>{try{let{data:l,error:i}=await o.auth.signUp({email:e,password:r,options:{data:{username:t,full_name:s,experience_level:a}}});if(i)return console.error("Auth signup error:",i),{error:i};if(!l.user)return console.error("No user data returned"),{error:Error("No user data returned")};let{error:n}=await o.from("profiles").insert({id:l.user.id,username:t,full_name:s,experience_level:a});if(n){if(console.error("Error creating profile:",n),"42P01"===n.code)return console.error("La tabla profiles no existe. Ejecuta el schema de Supabase."),{error:Error("Database not configured. Please contact support.")};return{error:n}}return console.log("User and profile created successfully"),{error:null}}catch(e){return console.error("Unexpected signup error:",e),{error:e}}},j=async()=>{let{error:e}=await o.auth.signOut();e&&console.error("Error signing out:",e)},N=async e=>{if(!t)return{error:Error("No user logged in")};try{let{error:r}=await o.from("profiles").update(e).eq("id",t.id);return r||u(r=>r?{...r,...e}:null),{error:r}}catch(e){return{error:e}}},_=async()=>{t&&await b(t.id)};return(0,s.jsx)(c.Provider,{value:{user:t,session:i,profile:d,stats:m,loading:x,signIn:y,signUp:w,signOut:j,updateProfile:N,refreshStats:_,isNewUser:f},children:r})}},2138:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},2657:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2919:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},3999:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l});var s=t(2596),a=t(9688);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},5695:(e,r,t)=>{"use strict";var s=t(8999);t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}})},7168:(e,r,t)=>{"use strict";t.d(r,{$:()=>o});var s=t(5155);t(2115);var a=t(9708),l=t(2085),i=t(3999);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:r,variant:t,size:l,asChild:o=!1,...c}=e,d=o?a.DX:"button";return(0,s.jsx)(d,{"data-slot":"button",className:(0,i.cn)(n({variant:t,size:l,className:r})),...c})}},7550:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8749:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},8883:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},9309:(e,r,t)=>{Promise.resolve().then(t.bind(t,9598))},9598:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var s=t(5155),a=t(2115),l=t(5695),i=t(6874),n=t.n(i),o=t(7168),c=t(1089),d=t(6813),u=t(8883),m=t(2919),h=t(8749),x=t(2657),p=t(2138),f=t(7550);function g(){let[e,r]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),[g,v]=(0,a.useState)({}),[b,y]=(0,a.useState)({email:"",password:""}),{signIn:w,user:j,loading:N}=(0,c.A)(),_=(0,l.useRouter)();(0,a.useEffect)(()=>{!N&&j&&_.push("/dashboard")},[j,N,_]);let k=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Ingresa un email v\xe1lido",A=async e=>{e.preventDefault(),i(!0),v({});let r={},t=k(b.email);if(t&&(r.email=t),b.password||(r.password="La contrase\xf1a es requerida"),Object.keys(r).length>0){v(r),i(!1);return}let{error:s}=await w(b.email,b.password);s&&v({general:"Email o contrase\xf1a incorrectos"}),i(!1)};return N?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsxs)(n(),{href:"/",className:"flex items-center",children:[(0,s.jsx)(d.A,{className:"h-12 w-12 text-blue-600"}),(0,s.jsx)("span",{className:"ml-3 text-2xl font-bold text-gray-900",children:"ComSigns"})]})}),(0,s.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Inicia sesi\xf3n en tu cuenta"}),(0,s.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-600",children:["\xbfNo tienes cuenta?"," ",(0,s.jsx)(n(),{href:"/auth/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"Reg\xedstrate aqu\xed"})]})]}),(0,s.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,s.jsxs)("div",{className:"bg-white py-8 px-4 shadow-xl rounded-lg sm:px-10",children:[g.general&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsx)("p",{className:"text-red-600 text-sm",children:g.general})}),(0,s.jsxs)("form",{className:"space-y-6",onSubmit:A,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,s.jsxs)("div",{className:"mt-1 relative",children:[(0,s.jsx)(u.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,s.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:b.email,onChange:e=>y({...b,email:e.target.value}),className:"appearance-none block w-full pl-10 pr-3 py-2 border rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ".concat(g.email?"border-red-300":"border-gray-300"),placeholder:"tu@email.com"})]}),g.email&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Contrase\xf1a"}),(0,s.jsxs)("div",{className:"mt-1 relative",children:[(0,s.jsx)(m.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,s.jsx)("input",{id:"password",name:"password",type:e?"text":"password",autoComplete:"current-password",required:!0,value:b.password,onChange:e=>y({...b,password:e.target.value}),className:"appearance-none block w-full pl-10 pr-10 py-2 border rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ".concat(g.password?"border-red-300":"border-gray-300"),placeholder:"Tu contrase\xf1a"}),(0,s.jsx)("button",{type:"button",onClick:()=>r(!e),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e?(0,s.jsx)(h.A,{size:20}):(0,s.jsx)(x.A,{size:20})})]}),g.password&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.password})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Recordarme"})]}),(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsx)("a",{href:"#",className:"font-medium text-blue-600 hover:text-blue-500",children:"\xbfOlvidaste tu contrase\xf1a?"})})]}),(0,s.jsx)("div",{children:(0,s.jsx)(o.$,{type:"submit",disabled:t,className:"w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:t?(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):(0,s.jsxs)(s.Fragment,{children:["Iniciar Sesi\xf3n",(0,s.jsx)(p.A,{className:"ml-2 h-4 w-4"})]})})})]}),(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,s.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,s.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,s.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"O contin\xfaa con"})})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(n(),{href:"/auth/register",children:(0,s.jsx)(o.$,{variant:"outline",className:"w-full",children:"\xbfNo tienes cuenta? Reg\xedstrate"})})}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(n(),{href:"/",children:(0,s.jsxs)(o.$,{variant:"ghost",className:"w-full",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Volver al inicio"]})})})]})]})})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[211,647,441,684,358],()=>r(9309)),_N_E=e.O()}]);