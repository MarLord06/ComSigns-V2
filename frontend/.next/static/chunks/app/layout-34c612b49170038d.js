(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1906:(e,r,t)=>{Promise.resolve().then(t.bind(t,6052)),Promise.resolve().then(t.t.bind(t,5688,23)),Promise.resolve().then(t.t.bind(t,9432,23)),Promise.resolve().then(t.t.bind(t,9324,23))},3168:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var o=t(2354);let s="https://xqdlbbwavnmkewvjaget.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxZGxiYndhdm5ta2V3dmphZ2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwOTUxNjksImV4cCI6MjA2ODY3MTE2OX0.MRfDvIbM8zOEwTj6muzZTzeNwWoQ-TfjzExjMIabLs4";if(!s)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!a)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let n=(0,o.UU)(s,a,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},5688:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},6052:(e,r,t)=>{"use strict";t.d(r,{A:()=>l,AuthProvider:()=>i});var o=t(5155),s=t(2115),a=t(3168);let n=(0,s.createContext)(void 0),l=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},i=e=>{let{children:r}=e,[t,l]=(0,s.useState)(null),[i,u]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[_,g]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),[h,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{console.log("Initializing auth..."),(async()=>{var e;let{data:{session:r},error:t}=await a.N.auth.getSession();if(t){console.error("Error getting session:",t),f(!1);return}console.log("Initial session:",r?"Found":"Not found"),u(r),l(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&(console.log("User found, loading profile and stats..."),await v(r.user.id),await E(r.user.id)),f(!1),console.log("Auth initialization complete")})();let{data:{subscription:e}}=a.N.auth.onAuthStateChange(async(e,r)=>{var t;console.log("Auth state changed:",e),u(r),l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?(console.log("Loading user data..."),v(r.user.id),E(r.user.id)):(d(null),g(null),p(!1)),f(!1)});return()=>{e.unsubscribe()}},[]);let v=async e=>{try{console.log("Loading profile for user:",e);let{data:r,error:t}=await a.N.from("user_profiles").select("*").eq("id",e).maybeSingle();if(t){console.error("Error loading profile:",t),("42P01"===t.code||t.message.includes("does not exist"))&&(console.log("Forcing logout due to profile error"),await a.N.auth.signOut());return}if(!r){console.log("No profile found for user, user might have been deleted"),await a.N.auth.signOut();return}console.log("Profile data:",r),d(r)}catch(e){console.error("Error loading profile:",e),await a.N.auth.signOut()}},E=async e=>{try{console.log("Loading stats for user:",e);let{data:r,error:t}=await a.N.from("game_attempts").select("points_earned, is_correct, time_taken_seconds").eq("user_id",e);if(t){console.log("No stats yet, using defaults:",t),g({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1}),p(!0);return}if(console.log("Attempts data:",r),r&&r.length>0){let e=r.filter(e=>e.is_correct),t={total_sessions:r.length,total_practice_time:r.reduce((e,r)=>e+(r.time_taken_seconds||0),0),letters_completed:[],average_accuracy:e.length/r.length,current_streak:0,best_streak:0,total_points:r.reduce((e,r)=>e+(r.points_earned||0),0),level:Math.floor(r.reduce((e,r)=>e+(r.points_earned||0),0)/100)+1};g(t),p(0===t.total_sessions),console.log("Stats loaded successfully:",t)}else g({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1}),p(!0),console.log("Using default stats for new user")}catch(e){console.error("Error loading stats:",e),g({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1})}},N=async(e,r)=>{try{var t;console.log("Attempting login for:",e);let{data:o,error:s}=await a.N.auth.signInWithPassword({email:e,password:r});if(s){if(console.error("Login error:",s),s.message.includes("Email not confirmed"))return console.error("Email needs confirmation"),{error:{name:"AuthError",message:"Confirma tu email antes de iniciar sesi\xf3n",status:400,code:"email_not_confirmed",__isAuthError:!0}};if(s.message.includes("Invalid login credentials"))return console.error("Invalid credentials"),{error:{name:"AuthError",message:"Email o contrase\xf1a incorrectos",status:400,code:"invalid_login",__isAuthError:!0}};return{error:s}}return console.log("Login successful:",null===(t=o.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Unexpected login error:",e),{error:{name:"AuthError",message:e instanceof Error?e.message:"Unknown error",status:400,code:"unexpected",__isAuthError:!0}}}},b=async(e,r,t,o,s)=>{try{let{data:n,error:l}=await a.N.auth.signUp({email:e,password:r,options:{data:{username:t,full_name:o,experience_level:s}}});if(l)return console.error("Auth signup error:",l),{error:l};if(!n.user)return console.error("No user data returned"),{error:{name:"AuthError",message:"No user data returned",status:400,code:"no_user",__isAuthError:!0}};let{error:i}=await a.N.from("user_profiles").insert({id:n.user.id,username:t,full_name:o,experience_level:s});if(i){if(console.error("Error creating profile:",i),"42P01"===i.code)return console.error("La tabla profiles no existe. Ejecuta el schema de Supabase."),{error:{name:"AuthError",message:"Database not configured. Please contact support.",status:500,code:"db_not_configured",__isAuthError:!0}};return{error:i}}return console.log("User and profile created successfully"),{error:null}}catch(e){return console.error("Unexpected signup error:",e),{error:{name:"AuthError",message:e instanceof Error?e.message:"Unknown error",status:400,code:"unexpected",__isAuthError:!0}}}},w=async()=>{let{error:e}=await a.N.auth.signOut();e&&console.error("Error signing out:",e)},y=async e=>{if(!t)return{error:Error("No user logged in")};try{let{error:r}=await a.N.from("user_profiles").update(e).eq("id",t.id);return r||d(r=>r?{...r,...e}:null),{error:r}}catch(e){return{error:e}}},A=async()=>{t&&await E(t.id)},I=async()=>{t&&await A()};return(0,o.jsx)(n.Provider,{value:{user:t,session:i,profile:c,stats:_,loading:m,signIn:N,signUp:b,signOut:w,updateProfile:y,refreshStats:A,isNewUser:h,completeTutorial:I},children:r})}},9324:()=>{},9432:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{var r=r=>e(e.s=r);e.O(0,[261,354,441,684,358],()=>r(1906)),_N_E=e.O()}]);