"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{1397:(e,t,r)=>{r.d(t,{k:()=>l});var s=r(5155);r(2115);var a=r(5863),n=r(3999);function l(e){let{className:t,value:r,...l}=e;return(0,s.jsx)(a.bL,{"data-slot":"progress",className:(0,n.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...l,children:(0,s.jsx)(a.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})}},4934:(e,t,r)=>{r.d(t,{hz:()=>i,Ur:()=>j,y9:()=>y,FW:()=>h});var s=r(5155),a=r(2115),n=r(8482),l=r(4355);let i=(0,a.forwardRef)(function(e,t){let{isActive:r,onError:i,className:o,width:c=640,height:d=480}=e,u=(0,a.useRef)(null),m=(0,a.useRef)(null),h=(0,a.useRef)(null);return((0,a.useImperativeHandle)(t,()=>({captureFrame:async()=>{if(!u.current||!m.current)return null;let e=m.current,t=u.current,r=e.getContext("2d");return r?(e.width=t.videoWidth,e.height=t.videoHeight,r.drawImage(t,0,0),new Promise(t=>{e.toBlob(e=>{e?t(new File([e],"frame.jpg",{type:"image/jpeg"})):t(null)},"image/jpeg",.8)})):null},getVideoElement:()=>u.current})),(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{if(!r){h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null),u.current&&(u.current.srcObject=null);return}let t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:c},height:{ideal:d},facingMode:"user"}});if(!e){t.getTracks().forEach(e=>e.stop());return}h.current=t,u.current&&(u.current.srcObject=t)}catch(e){console.error("Error accessing camera:",e),i&&i("Error accediendo a la c\xe1mara: ".concat(e instanceof Error?e.message:"Error desconocido"))}})(),()=>{e=!1,h.current&&h.current.getTracks().forEach(e=>e.stop())}},[r,c,d,i]),r)?(0,s.jsx)(n.Zp,{className:o,children:(0,s.jsx)(n.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto rounded-lg bg-black",style:{aspectRatio:"".concat(c,"/").concat(d)}}),(0,s.jsx)("canvas",{ref:m,className:"hidden"}),(0,s.jsx)("div",{className:"absolute top-2 left-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-black/50 text-white px-2 py-1 rounded text-xs",children:[(0,s.jsx)("div",{className:"h-2 w-2 bg-red-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{children:"EN VIVO"})]})})]})})}):(0,s.jsx)(n.Zp,{className:o,children:(0,s.jsx)(n.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"C\xe1mara desactivada"}),(0,s.jsx)("p",{className:"text-sm",children:"Activa la c\xe1mara para comenzar"})]})})})});var o=r(8145),c=r(1397),d=r(6813),u=r(4186),m=r(3999);function h(e){let{result:t,isProcessing:r,className:a,currentPrediction:l="",confidence:i=0}=e;return r?(0,s.jsxs)(n.Zp,{className:a,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full"}),"Traduciendo en tiempo real..."]})}),(0,s.jsx)(n.Wu,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl font-bold text-primary mb-2",children:l||"?"}),i>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Confianza:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,m.Me)(i)})]}),(0,s.jsx)(c.k,{value:100*i,className:"w-full"})]})]})})]}):t||r?t?(0,s.jsxs)(n.Zp,{className:a,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Resultado de Traducci\xf3n"}),t.success?(0,s.jsx)(o.E,{variant:"default",className:"bg-green-100 text-green-800",children:"\xc9xito"}):(0,s.jsx)(o.E,{variant:"destructive",children:"Sin detecci\xf3n"})]})}),(0,s.jsx)(n.Wu,{className:"space-y-4",children:t.success&&t.result?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl font-bold text-primary mb-2",children:t.result.text||"?"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Texto detectado"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Confianza"}),(0,s.jsx)("span",{children:(0,m.Me)(t.result.confidence)})]}),(0,s.jsx)(c.k,{value:100*t.result.confidence,className:"h-2"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("span",{children:[t.result.processing_time_ms,"ms"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("span",{children:[t.result.signs_detected," se\xf1al(es)"]})]})]}),t.result.detailed_predictions&&t.result.detailed_predictions.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"text-sm font-medium",children:"Predicciones detalladas:"}),(0,s.jsx)("div",{className:"space-y-1",children:t.result.detailed_predictions.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between text-xs bg-gray-50 p-2 rounded",children:[(0,s.jsx)("span",{className:"font-medium",children:e.sign}),(0,s.jsx)("span",{children:(0,m.Me)(e.confidence)})]},t))})]})]}):(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:(0,s.jsx)("p",{children:t.message||"No se detectaron se\xf1ales v\xe1lidas"})})})]}):null:(0,s.jsx)(n.Zp,{className:a,children:(0,s.jsx)(n.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(d.A,{className:"h-12 w-12 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Muestra tu mano para comenzar la traducci\xf3n"})]})})})}var g=r(7168),f=r(6645);let x=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(f.bL,{className:(0,m.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...a,ref:t,children:(0,s.jsx)(f.zi,{className:(0,m.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});x.displayName=f.bL.displayName;var p=r(6517),v=r(4449),E=r(136),b=r(8979),w=r(5690),N=r(381);function j(e){let{isTranslating:t,isCameraActive:r,isBackendConnected:a,onToggleTranslation:i,onToggleCamera:c,onSettings:d,translationCount:u=0,className:m}=e;return(0,s.jsxs)(n.Zp,{className:m,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Control"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(o.E,{variant:a?"default":"destructive",className:"text-xs",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"h-3 w-3 mr-1"}),"Conectado"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Desconectado"]})})})]})}),(0,s.jsxs)(n.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)(g.$,{onClick:c,variant:r?"default":"outline",className:"w-full",disabled:!a,children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Desactivar"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.A,{className:"h-4 w-4 mr-2"}),"Activar C\xe1mara"]})}),(0,s.jsx)(g.$,{onClick:i,variant:t?"destructive":"default",className:"w-full",disabled:!r||!a,children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Parar"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Iniciar"]})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"Traducci\xf3n autom\xe1tica"}),(0,s.jsx)(x,{checked:t,onCheckedChange:i,disabled:!r||!a})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"Traducciones realizadas"}),(0,s.jsx)(o.E,{variant:"outline",children:u})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(r?"bg-green-500":"bg-gray-300")}),"C\xe1mara"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(a?"bg-green-500":"bg-red-500")}),"Backend"]})]})}),d&&(0,s.jsxs)(g.$,{onClick:d,variant:"ghost",size:"sm",className:"w-full",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Configuraci\xf3n"]})]})]})}function y(e){let{cameraView:t,translationResult:r,controlPanel:a,className:n}=e;return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 ".concat(n),children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Traductor de Lenguaje de Se\xf1as"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Muestra tu mano para traducir letras del alfabeto de se\xf1as"})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:t})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:a}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:r})]})]})})})}},8087:(e,t,r)=>{r.d(t,{kh:()=>u,VF:()=>i,lw:()=>p}),r(5695);var s=r(6052),a=r(3392),n=r(2115),l=r(233);function i(){let[e,t]=(0,n.useState)(!1),[r,s]=(0,n.useState)("prompt"),[i,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(""),u=(0,n.useRef)(null),m=(0,n.useRef)(null),[h,g]=(0,n.useState)(!1),[f,x]=(0,n.useState)(""),[p,v]=(0,n.useState)(0),[E,b]=(0,n.useState)(null),w=(0,n.useRef)(null),N=(0,n.useRef)(null),{status:j,lastPrediction:y,error:A,connect:_,disconnect:C,sendFrame:I}=(0,a.U)({autoConnect:!1,log:!0});(0,n.useEffect)(()=>{A&&d(A)},[A]),(0,n.useEffect)(()=>{if(!y)return;console.log("[CAM] nueva predicci\xf3n",y);let e=y.letter||"",t=y.confidence||0;t>=l.UC.ACCEPT&&e?x(e):e||x("?"),v(t),b({success:!0,method:"websocket_prediction",result:{text:e||"?",confidence:t,processing_time_ms:y.processingTimeMs||0,signs_detected:+!!y.hasLandmarks,detailed_predictions:[]}})},[y]),(0,n.useEffect)(()=>{t("undefined"!=typeof navigator&&"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices)},[]);let M=(0,n.useCallback)(async()=>{if(!e)return d("Camera not supported in this browser"),!1;try{o(!0),d("");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});return u.current&&(u.current.srcObject=e,m.current=e),s("granted"),!0}catch(e){return d(e.message||"Camera access failed"),s("denied"),!1}finally{o(!1)}},[e]),O=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t||h;if(console.debug("[CAM] captureAndSendFrame llamado, isTranslating:",h,"forceTranslating:",t,"shouldTranslate:",r),!r){console.debug("[CAM] No traduciendo, saliendo");return}if(!(null==e?void 0:e.current)){console.debug("[CAM] Sin cameraViewRef.current, saliendo");return}try{var s,a;let t=(null===(s=(a=e.current).getVideoElement)||void 0===s?void 0:s.call(a))||u.current;if(!t){console.debug("[CAM] Sin videoElement, saliendo");return}if(t.readyState<2){console.debug("[CAM] Video no listo, readyState:",t.readyState);return}w.current||(w.current=document.createElement("canvas"));let r=w.current;r.width=t.videoWidth||640,r.height=t.videoHeight||480;let n=r.getContext("2d");if(!n){console.debug("[CAM] Sin contexto canvas, saliendo");return}n.drawImage(t,0,0,r.width,r.height);let l=r.toDataURL("image/jpeg",.8).split(",")[1];console.debug("[CAM] frame enviado len=",null==l?void 0:l.length),l&&I(l)}catch(e){console.error("[CAM] error capturando frame",e)}},[h,I]),T=(0,n.useCallback)(e=>{!h&&(console.log("[CAM] iniciar realtime, cameraViewRef:",!!(null==e?void 0:e.current)),_(),g(!0),x(""),v(0),N.current=setInterval(()=>{console.debug("[CAM] interval tick"),O(e,!0)},200),console.log("[CAM] interval iniciado con ID:",N.current))},[h,_,O]),k=(0,n.useCallback)(()=>{h&&(console.log("[CAM] detener realtime"),g(!1),N.current&&(clearInterval(N.current),N.current=null),C())},[h,C]);(0,n.useEffect)(()=>()=>{N.current&&clearInterval(N.current)},[]);let S=(0,n.useCallback)(()=>{m.current&&(m.current.getTracks().forEach(e=>e.stop()),m.current=null),u.current&&(u.current.srcObject=null),k(),s("prompt"),d("")},[k]),D=(0,n.useCallback)(()=>{if(!u.current)return Promise.resolve(null);let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=u.current.videoWidth,e.height=u.current.videoHeight,t.drawImage(u.current,0,0),new Promise(t=>{e.toBlob(e=>{e?t(new File([e],"frame.jpg",{type:"image/jpeg"})):t(null)},"image/jpeg",.8)})):Promise.resolve(null)},[]);return{videoRef:u,isSupported:e,permission:r,isInitializing:i,error:c,initialize:M,cleanup:S,captureFrame:D,isTranslating:h,currentPrediction:f,confidence:p,lastTranslation:E,startRealtimeTranslation:T,stopRealtimeTranslation:k,realtimeStatus:j}}r(896);class o{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(this.baseURL).concat(e),s={...t,headers:{...t.headers}},a=new AbortController,n=setTimeout(()=>a.abort(),this.timeout);try{let e=await fetch(r,{...s,signal:a.signal});if(clearTimeout(n),!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status))}return await e.json()}catch(e){if(clearTimeout(n),e instanceof Error){if("AbortError"===e.name)throw Error("Request timeout");throw e}throw Error("Unknown error occurred")}}async post(e,t){return this.request(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async get(e){return this.request(e,{method:"GET"})}async postFormData(e,t){return this.request(e,{method:"POST",body:t})}constructor(){this.baseURL="http://localhost:8000",this.timeout=1e4}}class c{async translateFrame(e){let t=new FormData;t.append("file",e);try{return await this.client.postFormData("/api/v1/ml/predict/upload",t)}catch(e){throw console.error("Translation error:",e),Error(e instanceof Error?e.message:"Translation failed")}}async healthCheck(){try{return await this.client.get("/api/v1/ml/health")}catch(e){throw Error("Health check failed")}}async getModelInfo(){try{return await this.client.get("/api/v1/ml/model/info")}catch(e){throw Error("Failed to get model info")}}constructor(){this.client=new o}}let d=new c;function u(){let[e,t]=(0,n.useState)(!1),[r,s]=(0,n.useState)(!1),[a,l]=(0,n.useState)(null),i=(0,n.useRef)(null),o=(0,n.useCallback)(async()=>{try{s(!0),await d.healthCheck(),t(!0),l(new Date)}catch(e){t(!1)}finally{s(!1)}},[]);return(0,n.useEffect)(()=>(o(),i.current=setInterval(o,15e3),()=>{i.current&&clearInterval(i.current)}),[o]),{isConnected:e,isChecking:r,lastCheck:a,checkConnection:o}}class m{async getUserProfile(){try{let e=await this.getAuthHeaders(),t=await fetch("".concat(this.baseUrl,"/user/profile"),{method:"GET",headers:{"Content-Type":"application/json",...e}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return(await t.json()).profile}catch(e){throw console.error("Error getting user profile:",e),e}}async getGameLevels(){try{let e=await this.getAllLetters();if(0===e.length)throw Error("No hay letras disponibles en el sistema");let t=1;try{t=(await this.getUserProfile()).current_level||1,console.log("[LEVELS] User current level:",t)}catch(e){console.warn("[LEVELS] Could not get user profile, defaulting to level 1:",e)}let r={easy:["SOL","MAR","PAN","CASA","MESA","AGUA","LUNA","GATO","PERRO","AMOR","MAM\xc1","PAP\xc1","NI\xd1O","NI\xd1A"],medium:["ESCUELA","FAMILIA","HERMANO","COMIDA","TRABAJO","SALUD","CIUDAD","AMIGO","TIEMPO","DINERO","VENTANA","PUERTA"],hard:["COMPUTADORA","UNIVERSIDAD","COMUNICACI\xd3N","DESARROLLO","TECNOLOG\xcdA","OPORTUNIDAD","EXPERIENCIA","CONOCIMIENTO"]},s=[{id:1,name:"Palabras B\xe1sicas",description:"Palabras simples de 3-5 letras",difficulty:"easy",unlocked:t>=1,completed:t>1,stars:0,words_length:[3,5],time_limit:45,lives:5,points_multiplier:1,words:r.easy.filter(t=>t.split("").every(t=>e.some(e=>e.letter===t))).slice(0,8)},{id:2,name:"Palabras Intermedias",description:"Palabras de 6-8 letras",difficulty:"medium",unlocked:t>=2,completed:t>2,stars:0,words_length:[6,8],time_limit:60,lives:4,points_multiplier:1.5,words:r.medium.filter(t=>t.split("").every(t=>e.some(e=>e.letter===t))).slice(0,6)},{id:3,name:"Palabras Avanzadas",description:"Palabras largas y complejas",difficulty:"hard",unlocked:t>=3,completed:t>3,stars:0,words_length:[9,15],time_limit:90,lives:3,points_multiplier:2,words:r.hard.filter(t=>t.split("").every(t=>e.some(e=>e.letter===t))).slice(0,4)}].filter(e=>e.words.length>0);return console.log("[LEVELS] Generated levels:",s.map(e=>({id:e.id,name:e.name,unlocked:e.unlocked,completed:e.completed}))),{levels:s,total_levels:s.length}}catch(t){console.error("Error fetching game levels:",t);let e=[{id:1,name:"Palabras B\xe1sicas",description:"Nivel de prueba con palabras simples",difficulty:"easy",unlocked:!0,completed:!1,stars:0,words_length:[3,5],time_limit:45,lives:5,points_multiplier:1,words:["SOL","MAR","PAN","CASA","MESA"]}];return{levels:e,total_levels:e.length}}}async startGameSession(e,t){try{console.log("[GAMIFICATION_SERVICE] Starting game session:",{levelId:e,userId:t});let r=await this.getAuthHeaders();console.log("[GAMIFICATION_SERVICE] Auth headers:",r);let s=await fetch("".concat(this.baseUrl,"/game/start"),{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify({session_type:"practice",user_id:t})});if(console.log("[GAMIFICATION_SERVICE] Response status:",s.status),!s.ok){let e=await s.text();throw console.error("[GAMIFICATION_SERVICE] Response error:",e),Error("HTTP error! status: ".concat(s.status))}let a=await s.json();if(console.log("[GAMIFICATION_SERVICE] Response data:",a),!a.session)throw console.error("Backend did not return a session object:",a),Error("Backend did not return a valid session");let n=a.session.id||a.session.session_id;if(!n)throw console.error("Backend session has no ID:",a.session),Error("Backend did not return a valid session ID");return console.log("[GAMIFICATION_SERVICE] ✅ Session started successfully with ID:",n),{session_id:n,level_id:e,user_id:t,started_at:a.session.started_at||new Date().toISOString(),status:"active",current_word_index:0,score:0,lives_remaining:a.session.lives_remaining||5}}catch(e){throw console.error("Error starting game session:",e),e}}async endGameSession(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{console.log("[GAMIFICATION_SERVICE] Ending game session:",{sessionId:e,finalScore:t,userId:r,completed:s});let a=await this.getAuthHeaders();console.log("[GAMIFICATION_SERVICE] Auth headers for end:",a);let n=await fetch("".concat(this.baseUrl,"/game/end"),{method:"POST",headers:{"Content-Type":"application/json",...a},body:JSON.stringify({session_id:e,final_score:t,user_id:r})});if(console.log("[GAMIFICATION_SERVICE] End response status:",n.status),!n.ok){let e=await n.text();throw console.error("[GAMIFICATION_SERVICE] End response error:",e),Error("HTTP error! status: ".concat(n.status))}let l=await n.json();return console.log("[GAMIFICATION_SERVICE] Game ended successfully:",l),l}catch(e){throw console.error("[GAMIFICATION_SERVICE] Error ending game session:",e),e}}async recordAttempt(e){try{console.log("[GAMIFICATION_SERVICE] \uD83D\uDCDD Enviando intento al backend:",{target_word:e.target_word,predicted_word:e.predicted_word,is_correct:e.is_correct,user_id:e.user_id});let t=await fetch("".concat(this.baseUrl,"/game/attempt"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e.session_id,user_id:e.user_id,letter_id:this.getLetterIdFromName(e.target_letter),is_correct:e.is_correct,time_taken:e.time_taken,confidence_score:e.confidence,target_word:e.target_word,predicted_word:e.predicted_word})});if(!t.ok){let e=await t.text();throw console.error("[GAMIFICATION_SERVICE] Error response:",e),Error("HTTP error! status: ".concat(t.status))}return await t.json()}catch(e){throw console.error("Error recording attempt:",e),e}}getLetterIdFromName(e){return({A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:10,K:11,L:12,M:13,N:14,O:15,P:16,Q:17,R:18,S:19,T:20,U:21,V:22,W:23,X:24,Y:25,Z:26})[e.toUpperCase()]||1}async getAllLetters(){try{let e=await fetch("".concat(this.baseUrl,"/letters"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).letters||[]}catch(e){return console.error("Error fetching letters:",e),[]}}async getRandomLetters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;try{let t=await fetch("".concat(this.baseUrl,"/letters/random/").concat(e));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return(await t.json()).letters||[]}catch(e){return console.error("Error fetching random letters:",e),[]}}async getChallenges(){try{let e=await fetch("".concat(this.baseUrl,"/challenges"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).challenges||[]}catch(e){return console.error("Error fetching challenges:",e),[]}}async getChallengesByType(e){try{let t=await fetch("".concat(this.baseUrl,"/challenges/type/").concat(e));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return(await t.json()).challenges||[]}catch(e){return console.error("Error fetching challenges by type:",e),[]}}async getChallengesByDifficulty(e){try{let t=await fetch("".concat(this.baseUrl,"/challenges/difficulty/").concat(e));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return(await t.json()).challenges||[]}catch(e){return console.error("Error fetching challenges by difficulty:",e),[]}}async getRandomChallenge(){try{let e=await fetch("".concat(this.baseUrl,"/challenges/random"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).challenge||null}catch(e){return console.error("Error fetching random challenge:",e),null}}async completeChallenge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;try{let r=await fetch("".concat(this.baseUrl,"/challenges/").concat(e,"/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:t})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}catch(e){throw console.error("Error completing challenge:",e),e}}async getLeaderboard(){try{let e=await fetch("".concat(this.baseUrl,"/leaderboard"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).leaderboard||[]}catch(e){return console.error("Error fetching leaderboard:",e),[]}}async getStats(){try{let e=await fetch("".concat(this.baseUrl,"/stats"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){return console.error("Error fetching stats:",e),{total_challenges:0,challenges_by_difficulty:{},challenges_by_type:{},max_points_available:0}}}constructor(e){this.baseUrl="".concat("http://localhost:8000","/api/v1/gamification"),this.getAuthHeaders=e||(()=>Promise.resolve({}))}}new m;let h=e=>new m(e);var g=r(3168);let f=async()=>{try{let{data:{session:e},error:t}=await g.N.auth.getSession();if(t)return console.error("Error getting session for auth headers:",t),{};if(null==e?void 0:e.access_token)return{Authorization:"Bearer ".concat(e.access_token)};return{}}catch(e){return console.error("Error creating auth headers:",e),{}}},x={currentWordIndex:0,score:0,lives:5,timeRemaining:30,correctWords:[],wrongWords:[],streak:0};function p(){let{user:e}=(0,s.A)(),t=h(f),[r,a]=(0,n.useState)("menu"),[l,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(x),[m,g]=(0,n.useState)([]),[p,v]=(0,n.useState)([]),[E,b]=(0,n.useState)(null),[w,N]=(0,n.useState)(null),[j,y]=(0,n.useState)(!1),[A,_]=(0,n.useState)(null),C=(0,n.useRef)(null),I=(0,n.useRef)([]),M=(0,n.useCallback)(()=>{C.current&&clearInterval(C.current),C.current=setInterval(()=>{u(e=>e.timeRemaining<=1?{...e,timeRemaining:0}:{...e,timeRemaining:e.timeRemaining-1})},1e3)},[]),O=(0,n.useCallback)(()=>{C.current&&(clearInterval(C.current),C.current=null)},[]),T=(0,n.useCallback)((e,t,r)=>{if(!o){console.warn("[GAME_MODE] No hay sesi\xf3n activa para acumular intento");return}let s={targetWord:e,predictedWord:t,isCorrect:r,timestamp:Date.now(),wordIndex:d.currentWordIndex};I.current.push(s),console.log("[GAME_MODE] \uD83D\uDCE6 INTENTO ACUMULADO: ".concat(e," → ").concat(t," (").concat(r?"✓":"✗",")")),console.log("[GAME_MODE] \uD83D\uDCCB Total intentos acumulados: ".concat(I.current.length))},[o,d.currentWordIndex]),k=(0,n.useCallback)(async()=>{if(!o||0===I.current.length||!(null==e?void 0:e.id)){console.log("[GAME_MODE] \uD83D\uDCED Sin intentos pendientes para enviar o user.id no disponible");return}let r=I.current;console.log("[GAME_MODE] \uD83D\uDE80 ENVIANDO LOTE DE ".concat(r.length," INTENTOS AL BACKEND..."));try{for(let[s,a]of r.entries())console.log("[GAME_MODE] \uD83D\uDCDD Enviando intento ".concat(s+1,"/").concat(r.length,": ").concat(a.targetWord," → ").concat(a.predictedWord)),await t.recordAttempt({session_id:o.session_id,user_id:e.id,target_letter:a.targetWord.charAt(0)||"A",predicted_letter:a.predictedWord.charAt(0)||"A",is_correct:a.isCorrect,confidence:.95,time_taken:1e3,word_index:a.wordIndex,target_word:a.targetWord,predicted_word:a.predictedWord}),await new Promise(e=>setTimeout(e,100));console.log("[GAME_MODE] ✅ TODOS LOS INTENTOS ENVIADOS EXITOSAMENTE (".concat(r.length,")")),I.current=[]}catch(e){console.error("[GAME_MODE] ❌ ERROR ENVIANDO LOTE DE INTENTOS:",e)}},[o,t,null==e?void 0:e.id]);(0,n.useEffect)(()=>{if(0===d.timeRemaining&&"playing"===r){if(console.log("[GAME_MODE] ⏰ TIMEOUT - Tiempo agotado, procesando como respuesta incorrecta"),d.lives<=0){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO timeout - Sin vidas restantes:",d.lives);return}E&&o&&T(E,"",!1),u(e=>({...e,lives:Math.max(0,e.lives-1),streak:0,timeRemaining:(null==l?void 0:l.time_limit)||30})),0>=Math.max(0,d.lives-1)&&(console.log("[GAME_MODE] \uD83D\uDC80 GAME OVER por timeout - Sin vidas restantes"),setTimeout(()=>a("game-over"),0))}},[d.timeRemaining,r,d.lives,E,l,o,T]);let S=(0,n.useCallback)(async()=>{y(!0),_(null);try{let e=await t.getGameLevels();g(e.levels)}catch(e){_(e instanceof Error?e.message:"Error loading levels")}finally{y(!1)}},[t]),D=(0,n.useCallback)(async e=>{let t=m.find(t=>t.id===e);if(!t){_("Level not found");return}i(t),v(t.words),a("level-select")},[m]),R=(0,n.useCallback)(async r=>{y(!0),_(null);try{console.log("[GAME_MODE] Starting game with levelId:",r);let s=m.find(e=>e.id===r);if(!s)throw console.error("[GAME_MODE] Level not found. Available levels:",m.map(e=>({id:e.id,name:e.name}))),Error("Level ".concat(r," not found"));console.log("[GAME_MODE] Found level:",s);let n=await t.startGameSession(r,null==e?void 0:e.id);I.current=[],i(s),c(n),v(s.words),b(s.words[0]||null),u({...x,lives:s.lives,timeRemaining:s.time_limit}),a("playing"),M()}catch(e){_(e instanceof Error?e.message:"Error starting game")}finally{y(!1)}},[m,M,t,null==e?void 0:e.id]),G=(0,n.useCallback)(()=>{"playing"===r&&(O(),a("paused"))},[r,O]),P=(0,n.useCallback)(()=>{"paused"===r&&(M(),a("playing"))},[r,M]),U=(0,n.useCallback)(()=>{if(!p.length)return;u(e=>{let t=e.currentWordIndex+1;return t>=p.length?e:{...e,currentWordIndex:t,timeRemaining:(null==l?void 0:l.time_limit)||30}});let e=d.currentWordIndex+1;e<p.length?b(p[e]):setTimeout(()=>a("completed"),0)},[p,l,d.currentWordIndex]),L=(0,n.useCallback)(e=>{if(l&&E){if(d.lives<=0||"playing"!==r){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO respuesta correcta - Juego inactivo:",{currentLives:d.lives,gameState:r});return}console.log("[GAME_MODE] \uD83C\uDFAF PROCESANDO RESPUESTA CORRECTA:",{word:e,currentWord:E}),T(E,e,!0),u(t=>({...t,score:t.score+100*l.points_multiplier*(t.streak+1),correctWords:[...t.correctWords,e],streak:t.streak+1})),U()}},[l,E,U,T,d.lives,r]),F=(0,n.useCallback)(e=>{if(!E)return;if(d.lives<=0){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO respuesta incorrecta - Sin vidas restantes:",{currentLives:d.lives,gameState:r});return}console.log("[GAME_MODE] \uD83D\uDCA5 PROCESANDO RESPUESTA INCORRECTA:",{currentWord:E,attemptedWord:e}),T(E,e||"",!1),u(t=>{let r=Math.max(0,t.lives-1),s={...t,lives:r,streak:0,timeRemaining:(null==l?void 0:l.time_limit)||30};return e&&(s.wrongWords=[...t.wrongWords,e]),s});let t=Math.max(0,d.lives-1);console.log("[GAME_MODE] \uD83D\uDC94 Vidas despu\xe9s de respuesta incorrecta:",{currentLives:d.lives,newLives:t,willTriggerGameOver:t<=0}),t<=0?(console.log("[GAME_MODE] \uD83D\uDC80 DISPARADOR ACTIVADO - Sin vidas, terminando juego..."),setTimeout(()=>{console.log("[GAME_MODE] \uD83D\uDC80 EJECUTANDO setGameState(game-over)"),a("game-over")},0)):U()},[l,E,d.lives,U,T,r]),V=(0,n.useCallback)(async function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(console.log("[GAME_MODE] \uD83D\uDE80 endGame LLAMADO:",{completed:s,currentState:r,currentSession:null==o?void 0:o.session_id,gameProgress:d.score}),!o){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO endGame - No hay sesi\xf3n activa");return}console.log("[GAME_MODE] \uD83C\uDFC1 TERMINANDO JUEGO:",{completed:s,currentState:r}),O(),console.log("[GAME_MODE] \uD83D\uDCE6 ENVIANDO intentos acumulados..."),await k();try{if(!(null==e?void 0:e.id)){console.error("[GAME_MODE] ❌ No user.id disponible para finalizar sesi\xf3n");return}console.log("[GAME_MODE] \uD83D\uDCDD Finalizando sesi\xf3n:",o.session_id);let r=await t.endGameSession(o.session_id,d.score,e.id,s);console.log("[GAME_MODE] ✅ Sesi\xf3n finalizada exitosamente:",r),c(null)}catch(e){console.error("[GAME_MODE] ❌ Error ending game session:",e)}},[O,o,d.score,r,k,t,null==e?void 0:e.id]),W=(0,n.useCallback)(()=>{O(),a("menu"),i(null),c(null),u(x),v([]),b(null),N(null),_(null),I.current=[]},[O]);return(0,n.useEffect)(()=>{if(console.log("[GAME_MODE] \uD83D\uDC40 Monitoreando gameState:",r),("game-over"===r||"completed"===r)&&o){let e="completed"===r;console.log("[GAME_MODE] \uD83C\uDFAE Estado cambi\xf3 a ".concat(r,", llamando endGame(").concat(e,")...")),V(e)}},[r,o]),(0,n.useEffect)(()=>()=>{O()},[O]),{gameState:r,currentLevel:l,currentSession:o,gameProgress:d,levels:m,currentWords:p,currentWord:E,currentChallenge:w,loadLevels:S,selectLevel:D,startGame:R,pauseGame:G,resumeGame:P,nextWord:U,processCorrectAnswer:L,processWrongAnswer:F,endGame:V,resetGame:W,isLoading:j,error:A}}},8145:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(5155);r(2115);var a=r(9708),n=r(2085),l=r(3999);let i=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,asChild:n=!1,...o}=e,c=n?a.DX:"span";return(0,s.jsx)(c,{"data-slot":"badge",className:(0,l.cn)(i({variant:r}),t),...o})}},8482:(e,t,r)=>{r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>l});var s=r(5155);r(2115);var a=r(3999);function n(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function i(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...r})}function c(e){let{className:t,...r}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...r})}},8693:(e,t,r)=>{r.d(t,{e:()=>p,K:()=>v});var s=r(5155),a=r(2115),n=r(7168),l=r(6427),i=r(7340),o=r(6785),c=r(288),d=r(5690),u=r(6813),m=r(4783),h=r(4416),g=r(6874),f=r.n(g);let x=[{href:"/",label:"Inicio",icon:i.A,key:"home"},{href:"/practice",label:"Pr\xe1ctica",icon:o.A,key:"practice"},{href:"/game",label:"Juego",icon:c.A,key:"game"},{href:"/translate",label:"Traducir",icon:d.A,key:"translate"}];function p(e){let{children:t,currentPage:r="home"}=e,[i,o]=(0,a.useState)(!1),c=()=>o(!1);return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-blue-600 focus:text-white focus:rounded-md focus:shadow-lg",children:"Saltar al contenido principal"}),(0,s.jsxs)("header",{className:"px-4 lg:px-6 h-16 flex items-center border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0 z-50",children:[(0,s.jsxs)(f(),{href:"/",className:"flex items-center justify-center",children:[(0,s.jsx)(u.A,{className:"h-8 w-8 text-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"ComSigns"})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>o(!0),className:"ml-4","aria-label":"Abrir men\xfa de navegaci\xf3n principal","aria-expanded":i,"aria-controls":"sidebar-nav",children:(0,s.jsx)(m.A,{className:"h-5 w-5"})}),(0,s.jsxs)("nav",{className:"ml-auto hidden md:flex gap-4 sm:gap-6 items-center",children:[x.map(e=>(0,s.jsx)(f(),{href:e.href,className:"text-sm font-medium transition-colors ".concat(r===e.key?"text-blue-600 border-b-2 border-blue-600":"hover:text-blue-600"),children:e.label},e.key)),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)(l.Nr,{})})]}),(0,s.jsx)("div",{className:"ml-auto md:hidden",children:(0,s.jsx)(l.Nr,{})})]}),i&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50",onClick:c}),(0,s.jsxs)("aside",{id:"sidebar-nav",className:"relative w-64 bg-white shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-lg font-bold",children:"ComSigns"})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:c,"aria-label":"Cerrar men\xfa",children:(0,s.jsx)(h.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("nav",{className:"p-4 space-y-2",children:x.map(e=>{let t=e.icon;return(0,s.jsxs)(f(),{href:e.href,className:"flex items-center gap-3 px-3 py-2 rounded-md transition-colors ".concat(r===e.key?"bg-blue-50 text-blue-600":"hover:bg-gray-100"),onClick:c,children:[(0,s.jsx)(t,{className:"h-5 w-5"}),e.label]},e.key)})})]})]}),(0,s.jsx)("main",{id:"main-content",className:"flex-1",children:t})]})}function v(e){let{title:t,subtitle:r,children:a,background:n="gradient",className:l=""}=e;return(0,s.jsx)("section",{className:"py-12 px-4 ".concat({gradient:"bg-gradient-to-b from-blue-50 to-white",solid:"bg-blue-50",custom:""}[n]," ").concat(l),children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:t}),r&&(0,s.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:r}),a]})})}}}]);