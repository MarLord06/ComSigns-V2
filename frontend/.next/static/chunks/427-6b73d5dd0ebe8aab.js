"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{1089:(e,r,t)=>{t.d(r,{AuthProvider:()=>d,A:()=>u});var s=t(5155),a=t(2115),n=t(5647);let i="https://xqdlbbwavnmkewvjaget.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxZGxiYndhdm5ta2V3dmphZ2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwOTUxNjksImV4cCI6MjA2ODY3MTE2OX0.MRfDvIbM8zOEwTj6muzZTzeNwWoQ-TfjzExjMIabLs4";if(!i)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY");let l=(0,n.UU)(i,o,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),c=(0,a.createContext)(void 0),u=()=>{let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:r}=e,[t,n]=(0,a.useState)(null),[i,o]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[g,h]=(0,a.useState)(null),[m,v]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{l.auth.getSession().then(e=>{var r;let{data:{session:t}}=e;o(t),n(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),(null==t?void 0:t.user)&&(x(t.user.id),b(t.user.id)),v(!1)});let{data:{subscription:e}}=l.auth.onAuthStateChange(async(e,r)=>{var t;o(r),n(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?(await x(r.user.id),await b(r.user.id),"SIGNED_IN"!==e||u||p(!0)):(d(null),h(null),p(!1)),v(!1)});return()=>e.unsubscribe()},[]);let x=async e=>{try{let{data:r,error:t}=await l.from("profiles").select("*").eq("id",e).single();if(t&&"PGRST116"!==t.code){console.error("Error loading profile:",t);return}d(r)}catch(e){console.error("Error loading profile:",e)}},b=async e=>{try{let{data:r,error:t}=await l.from("practice_results").select("score, accuracy, total_time_seconds").eq("session_id",e);t&&console.log("No stats yet, using defaults:",t);let s=r&&r.length>0?{total_sessions:r.length,total_practice_time:r.reduce((e,r)=>e+r.total_time_seconds,0),letters_completed:[],average_accuracy:r.reduce((e,r)=>e+r.accuracy,0)/r.length,current_streak:0,best_streak:0,total_points:r.reduce((e,r)=>e+r.score,0),level:Math.floor(r.reduce((e,r)=>e+r.score,0)/100)+1}:{total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1};h(s),console.log("Stats loaded successfully:",s)}catch(e){console.error("Error loading stats:",e),h({total_sessions:0,total_practice_time:0,letters_completed:[],average_accuracy:0,current_streak:0,best_streak:0,total_points:0,level:1})}},y=async(e,r)=>{try{var t;console.log("Attempting login for:",e);let{data:s,error:a}=await l.auth.signInWithPassword({email:e,password:r});if(a){if(console.error("Login error:",a),a.message.includes("Email not confirmed"))return console.error("Email needs confirmation"),{error:{...a,message:"Confirma tu email antes de iniciar sesi\xf3n"}};if(a.message.includes("Invalid login credentials"))return console.error("Invalid credentials"),{error:{...a,message:"Email o contrase\xf1a incorrectos"}};return{error:a}}return console.log("Login successful:",null===(t=s.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Unexpected login error:",e),{error:e}}},_=async(e,r,t,s,a)=>{try{let{data:n,error:i}=await l.auth.signUp({email:e,password:r,options:{data:{username:t,full_name:s,experience_level:a}}});if(i)return console.error("Auth signup error:",i),{error:i};if(!n.user)return console.error("No user data returned"),{error:Error("No user data returned")};let{error:o}=await l.from("profiles").insert({id:n.user.id,username:t,full_name:s,experience_level:a});if(o){if(console.error("Error creating profile:",o),"42P01"===o.code)return console.error("La tabla profiles no existe. Ejecuta el schema de Supabase."),{error:Error("Database not configured. Please contact support.")};return{error:o}}return console.log("User and profile created successfully"),{error:null}}catch(e){return console.error("Unexpected signup error:",e),{error:e}}},j=async()=>{let{error:e}=await l.auth.signOut();e&&console.error("Error signing out:",e)},w=async e=>{if(!t)return{error:Error("No user logged in")};try{let{error:r}=await l.from("profiles").update(e).eq("id",t.id);return r||d(r=>r?{...r,...e}:null),{error:r}}catch(e){return{error:e}}},N=async()=>{t&&await b(t.id)};return(0,s.jsx)(c.Provider,{value:{user:t,session:i,profile:u,stats:g,loading:m,signIn:y,signUp:_,signOut:j,updateProfile:w,refreshStats:N,isNewUser:f},children:r})}},3999:(e,r,t)=>{t.d(r,{cn:()=>n});var s=t(2596),a=t(9688);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},6427:(e,r,t)=>{t.d(r,{Nr:()=>h,OV:()=>v});var s=t(5155),a=t(2115),n=t(7168),i=t(1089),o=t(1007),l=t(2713),c=t(4835),u=t(306),d=t(6874),g=t.n(d);let h=()=>{let[e,r]=(0,a.useState)(!1),{user:t,profile:d,signOut:h,loading:m}=(0,i.A)();return m?(0,s.jsx)("div",{className:"animate-pulse",children:(0,s.jsx)("div",{className:"w-24 h-10 bg-gray-200 rounded-md"})}):t&&d?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(n.$,{onClick:()=>r(!e),variant:"outline",className:"flex items-center gap-2",children:[(0,s.jsx)(o.A,{size:18}),(0,s.jsx)("span",{className:"hidden sm:inline",children:d.username})]}),e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>r(!1)}),(0,s.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-20",children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:d.full_name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:t.email})]}),(0,s.jsxs)(g(),{href:"/dashboard",className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",onClick:()=>r(!1),children:[(0,s.jsx)(l.A,{size:16}),"Dashboard"]}),(0,s.jsxs)("button",{onClick:()=>{h(),r(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,s.jsx)(c.A,{size:16}),"Cerrar Sesi\xf3n"]})]})})]})]}):(0,s.jsx)(g(),{href:"/auth/login",children:(0,s.jsxs)(n.$,{className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,s.jsx)(u.A,{size:18,className:"mr-2"}),"Iniciar Sesi\xf3n"]})})};var m=t(5695);let v=e=>{let{children:r,redirectTo:t="/auth/login",requireProfile:n=!0}=e,{user:o,profile:l,loading:c}=(0,i.A)(),u=(0,m.useRouter)();return((0,a.useEffect)(()=>{if(!c){if(!o){u.push(t);return}if(n&&!l){console.error("Usuario sin perfil encontrado"),u.push(t);return}}},[o,l,c,u,t,n]),c)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"text-gray-600 mt-4",children:"Verificando autenticaci\xf3n..."})]})}):o&&(!n||l)?(0,s.jsx)(s.Fragment,{children:r}):null}},7168:(e,r,t)=>{t.d(r,{$:()=>l});var s=t(5155);t(2115);var a=t(9708),n=t(2085),i=t(3999);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:r,variant:t,size:n,asChild:l=!1,...c}=e,u=l?a.DX:"button";return(0,s.jsx)(u,{"data-slot":"button",className:(0,i.cn)(o({variant:t,size:n,className:r})),...c})}}}]);