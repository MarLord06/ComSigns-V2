"use strict";exports.id=423,exports.ids=[423],exports.modules={55005:(e,r,t)=>{t.d(r,{e:()=>p,K:()=>v});var s=t(60687),a=t(43210),n=t(24934),l=t(15982),i=t(32192),o=t(28947),c=t(3900),d=t(97840),u=t(6123),m=t(12941),h=t(11860),g=t(85814),f=t.n(g);let x=[{href:"/",label:"Inicio",icon:i.A,key:"home"},{href:"/practice",label:"Pr\xe1ctica",icon:o.A,key:"practice"},{href:"/game",label:"Juego",icon:c.A,key:"game"},{href:"/translate",label:"Traducir",icon:d.A,key:"translate"}];function p({children:e,currentPage:r="home"}){let[t,i]=(0,a.useState)(!1),o=()=>i(!1);return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-blue-600 focus:text-white focus:rounded-md focus:shadow-lg",children:"Saltar al contenido principal"}),(0,s.jsxs)("header",{className:"px-4 lg:px-6 h-16 flex items-center border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0 z-50",children:[(0,s.jsxs)(f(),{href:"/",className:"flex items-center justify-center",children:[(0,s.jsx)(u.A,{className:"h-8 w-8 text-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"ComSigns"})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"ml-4","aria-label":"Abrir men\xfa de navegaci\xf3n principal","aria-expanded":t,"aria-controls":"sidebar-nav",children:(0,s.jsx)(m.A,{className:"h-5 w-5"})}),(0,s.jsxs)("nav",{className:"ml-auto hidden md:flex gap-4 sm:gap-6 items-center",children:[x.map(e=>(0,s.jsx)(f(),{href:e.href,className:`text-sm font-medium transition-colors ${r===e.key?"text-blue-600 border-b-2 border-blue-600":"hover:text-blue-600"}`,children:e.label},e.key)),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)(l.Nr,{})})]}),(0,s.jsx)("div",{className:"ml-auto md:hidden",children:(0,s.jsx)(l.Nr,{})})]}),t&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50",onClick:o}),(0,s.jsxs)("aside",{id:"sidebar-nav",className:"relative w-64 bg-white shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-lg font-bold",children:"ComSigns"})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:o,"aria-label":"Cerrar men\xfa",children:(0,s.jsx)(h.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("nav",{className:"p-4 space-y-2",children:x.map(e=>{let t=e.icon;return(0,s.jsxs)(f(),{href:e.href,className:`flex items-center gap-3 px-3 py-2 rounded-md transition-colors ${r===e.key?"bg-blue-50 text-blue-600":"hover:bg-gray-100"}`,onClick:o,children:[(0,s.jsx)(t,{className:"h-5 w-5"}),e.label]},e.key)})})]})]}),(0,s.jsx)("main",{id:"main-content",className:"flex-1",children:e})]})}function v({title:e,subtitle:r,children:t,background:a="gradient",className:n=""}){return(0,s.jsx)("section",{className:`py-12 px-4 ${{gradient:"bg-gradient-to-b from-blue-50 to-white",solid:"bg-blue-50",custom:""}[a]} ${n}`,children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:e}),r&&(0,s.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:r}),t]})})}},55192:(e,r,t)=>{t.d(r,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>l});var s=t(60687);t(43210);var a=t(96241);function n({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function l({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function i({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function o({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function c({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}},59821:(e,r,t)=>{t.d(r,{E:()=>o});var s=t(60687);t(43210);var a=t(8730),n=t(24224),l=t(96241);let i=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:r,asChild:t=!1,...n}){let o=t?a.DX:"span";return(0,s.jsx)(o,{"data-slot":"badge",className:(0,l.cn)(i({variant:r}),e),...n})}},70511:(e,r,t)=>{t.d(r,{hz:()=>i,Ur:()=>j,y9:()=>y,FW:()=>h});var s=t(60687),a=t(43210),n=t(55192),l=t(51361);let i=(0,a.forwardRef)(function({isActive:e,onError:r,className:t,width:i=640,height:o=480},c){let d=(0,a.useRef)(null),u=(0,a.useRef)(null),m=(0,a.useRef)(null);return((0,a.useImperativeHandle)(c,()=>({captureFrame:async()=>{if(!d.current||!u.current)return null;let e=u.current,r=d.current,t=e.getContext("2d");return t?(e.width=r.videoWidth,e.height=r.videoHeight,t.drawImage(r,0,0),new Promise(r=>{e.toBlob(e=>{e?r(new File([e],"frame.jpg",{type:"image/jpeg"})):r(null)},"image/jpeg",.8)})):null},getVideoElement:()=>d.current})),(0,a.useEffect)(()=>{let t=!0;return(async()=>{try{if(!e){m.current&&(m.current.getTracks().forEach(e=>e.stop()),m.current=null),d.current&&(d.current.srcObject=null);return}let r=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:i},height:{ideal:o},facingMode:"user"}});if(!t){r.getTracks().forEach(e=>e.stop());return}m.current=r,d.current&&(d.current.srcObject=r)}catch(e){console.error("Error accessing camera:",e),r&&r(`Error accediendo a la c\xe1mara: ${e instanceof Error?e.message:"Error desconocido"}`)}})(),()=>{t=!1,m.current&&m.current.getTracks().forEach(e=>e.stop())}},[e,i,o,r]),e)?(0,s.jsx)(n.Zp,{className:t,children:(0,s.jsx)(n.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("video",{ref:d,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto rounded-lg bg-black",style:{aspectRatio:`${i}/${o}`}}),(0,s.jsx)("canvas",{ref:u,className:"hidden"}),(0,s.jsx)("div",{className:"absolute top-2 left-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-black/50 text-white px-2 py-1 rounded text-xs",children:[(0,s.jsx)("div",{className:"h-2 w-2 bg-red-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{children:"EN VIVO"})]})})]})})}):(0,s.jsx)(n.Zp,{className:t,children:(0,s.jsx)(n.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"C\xe1mara desactivada"}),(0,s.jsx)("p",{className:"text-sm",children:"Activa la c\xe1mara para comenzar"})]})})})});var o=t(59821),c=t(86287),d=t(6123),u=t(48730),m=t(96241);function h({result:e,isProcessing:r,className:t,currentPrediction:a="",confidence:l=0}){return r?(0,s.jsxs)(n.Zp,{className:t,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full"}),"Traduciendo en tiempo real..."]})}),(0,s.jsx)(n.Wu,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl font-bold text-primary mb-2",children:a||"?"}),l>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Confianza:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,m.Me)(l)})]}),(0,s.jsx)(c.k,{value:100*l,className:"w-full"})]})]})})]}):e||r?e?(0,s.jsxs)(n.Zp,{className:t,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Resultado de Traducci\xf3n"}),e.success?(0,s.jsx)(o.E,{variant:"default",className:"bg-green-100 text-green-800",children:"\xc9xito"}):(0,s.jsx)(o.E,{variant:"destructive",children:"Sin detecci\xf3n"})]})}),(0,s.jsx)(n.Wu,{className:"space-y-4",children:e.success&&e.result?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl font-bold text-primary mb-2",children:e.result.text||"?"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Texto detectado"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Confianza"}),(0,s.jsx)("span",{children:(0,m.Me)(e.result.confidence)})]}),(0,s.jsx)(c.k,{value:100*e.result.confidence,className:"h-2"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("span",{children:[e.result.processing_time_ms,"ms"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("span",{children:[e.result.signs_detected," se\xf1al(es)"]})]})]}),e.result.detailed_predictions&&e.result.detailed_predictions.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"text-sm font-medium",children:"Predicciones detalladas:"}),(0,s.jsx)("div",{className:"space-y-1",children:e.result.detailed_predictions.map((e,r)=>(0,s.jsxs)("div",{className:"flex justify-between text-xs bg-gray-50 p-2 rounded",children:[(0,s.jsx)("span",{className:"font-medium",children:e.sign}),(0,s.jsx)("span",{children:(0,m.Me)(e.confidence)})]},r))})]})]}):(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:(0,s.jsx)("p",{children:e.message||"No se detectaron se\xf1ales v\xe1lidas"})})})]}):null:(0,s.jsx)(n.Zp,{className:t,children:(0,s.jsx)(n.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(d.A,{className:"h-12 w-12 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Muestra tu mano para comenzar la traducci\xf3n"})]})})})}var g=t(24934),f=t(35800);let x=a.forwardRef(({className:e,...r},t)=>(0,s.jsx)(f.bL,{className:(0,m.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:t,children:(0,s.jsx)(f.zi,{className:(0,m.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));x.displayName=f.bL.displayName;var p=t(87891),v=t(70663),b=t(20673),w=t(23385),E=t(97840),N=t(84027);function j({isTranslating:e,isCameraActive:r,isBackendConnected:t,onToggleTranslation:a,onToggleCamera:i,onSettings:c,translationCount:d=0,className:u}){return(0,s.jsxs)(n.Zp,{className:u,children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Control"}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(o.E,{variant:t?"default":"destructive",className:"text-xs",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"h-3 w-3 mr-1"}),"Conectado"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Desconectado"]})})})]})}),(0,s.jsxs)(n.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)(g.$,{onClick:i,variant:r?"default":"outline",className:"w-full",disabled:!t,children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Desactivar"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.A,{className:"h-4 w-4 mr-2"}),"Activar C\xe1mara"]})}),(0,s.jsx)(g.$,{onClick:a,variant:e?"destructive":"default",className:"w-full",disabled:!r||!t,children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Parar"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Iniciar"]})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"Traducci\xf3n autom\xe1tica"}),(0,s.jsx)(x,{checked:e,onCheckedChange:a,disabled:!r||!t})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"Traducciones realizadas"}),(0,s.jsx)(o.E,{variant:"outline",children:d})]})]}),(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:`h-2 w-2 rounded-full ${r?"bg-green-500":"bg-gray-300"}`}),"C\xe1mara"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:`h-2 w-2 rounded-full ${t?"bg-green-500":"bg-red-500"}`}),"Backend"]})]})}),c&&(0,s.jsxs)(g.$,{onClick:c,variant:"ghost",size:"sm",className:"w-full",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Configuraci\xf3n"]})]})]})}function y({cameraView:e,translationResult:r,controlPanel:t,className:a}){return(0,s.jsx)("div",{className:`min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 ${a}`,children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Traductor de Lenguaje de Se\xf1as"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Muestra tu mano para traducir letras del alfabeto de se\xf1as"})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:e})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:t}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-1",children:r})]})]})})})}},86287:(e,r,t)=>{t.d(r,{k:()=>l});var s=t(60687);t(43210);var a=t(25177),n=t(96241);function l({className:e,value:r,...t}){return(0,s.jsx)(a.bL,{"data-slot":"progress",className:(0,n.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...t,children:(0,s.jsx)(a.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}},91597:(e,r,t)=>{t.d(r,{kh:()=>d,VF:()=>l,lw:()=>x}),t(16189);var s=t(45126),a=t(51752),n=t(43210);function l(){let[e,r]=(0,n.useState)(!1),[t,s]=(0,n.useState)("prompt"),[l,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(""),d=(0,n.useRef)(null),u=(0,n.useRef)(null),[m,h]=(0,n.useState)(!1),[g,f]=(0,n.useState)(""),[x,p]=(0,n.useState)(0),[v,b]=(0,n.useState)(null),w=(0,n.useRef)(null),E=(0,n.useRef)(null),{status:N,lastPrediction:j,error:y,connect:A,disconnect:C,sendFrame:I}=(0,a.U)({autoConnect:!1,log:!0}),_=(0,n.useCallback)(async()=>{if(!e)return c("Camera not supported in this browser"),!1;try{i(!0),c("");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});return d.current&&(d.current.srcObject=e,u.current=e),s("granted"),!0}catch(e){return c(e.message||"Camera access failed"),s("denied"),!1}finally{i(!1)}},[e]),O=(0,n.useCallback)((e,r=!1)=>{let t=r||m;if(console.debug("[CAM] captureAndSendFrame llamado, isTranslating:",m,"forceTranslating:",r,"shouldTranslate:",t),!t){console.debug("[CAM] No traduciendo, saliendo");return}if(!e?.current){console.debug("[CAM] Sin cameraViewRef.current, saliendo");return}try{let r=e.current.getVideoElement?.()||d.current;if(!r){console.debug("[CAM] Sin videoElement, saliendo");return}if(r.readyState<2){console.debug("[CAM] Video no listo, readyState:",r.readyState);return}w.current||(w.current=document.createElement("canvas"));let t=w.current;t.width=r.videoWidth||640,t.height=r.videoHeight||480;let s=t.getContext("2d");if(!s){console.debug("[CAM] Sin contexto canvas, saliendo");return}s.drawImage(r,0,0,t.width,t.height);let a=t.toDataURL("image/jpeg",.8).split(",")[1];console.debug("[CAM] frame enviado len=",a?.length),a&&I(a)}catch(e){console.error("[CAM] error capturando frame",e)}},[m,I]),T=(0,n.useCallback)(e=>{!m&&(console.log("[CAM] iniciar realtime, cameraViewRef:",!!e?.current),A(),h(!0),f(""),p(0),E.current=setInterval(()=>{console.debug("[CAM] interval tick"),O(e,!0)},200),console.log("[CAM] interval iniciado con ID:",E.current))},[m,A,O]),M=(0,n.useCallback)(()=>{m&&(console.log("[CAM] detener realtime"),h(!1),E.current&&(clearInterval(E.current),E.current=null),C())},[m,C]),k=(0,n.useCallback)(()=>{u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null),d.current&&(d.current.srcObject=null),M(),s("prompt"),c("")},[M]),S=(0,n.useCallback)(()=>{if(!d.current)return Promise.resolve(null);let e=document.createElement("canvas"),r=e.getContext("2d");return r?(e.width=d.current.videoWidth,e.height=d.current.videoHeight,r.drawImage(d.current,0,0),new Promise(r=>{e.toBlob(e=>{e?r(new File([e],"frame.jpg",{type:"image/jpeg"})):r(null)},"image/jpeg",.8)})):Promise.resolve(null)},[]);return{videoRef:d,isSupported:e,permission:t,isInitializing:l,error:o,initialize:_,cleanup:k,captureFrame:S,isTranslating:m,currentPrediction:g,confidence:x,lastTranslation:v,startRealtimeTranslation:T,stopRealtimeTranslation:M,realtimeStatus:N}}t(31313),t(24564);class i{constructor(){this.baseURL="http://localhost:8000",this.timeout=1e4}async request(e,r={}){let t=`${this.baseURL}${e}`,s={...r,headers:{...r.headers}},a=new AbortController,n=setTimeout(()=>a.abort(),this.timeout);try{let e=await fetch(t,{...s,signal:a.signal});if(clearTimeout(n),!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||`HTTP ${e.status}`)}return await e.json()}catch(e){if(clearTimeout(n),e instanceof Error){if("AbortError"===e.name)throw Error("Request timeout");throw e}throw Error("Unknown error occurred")}}async post(e,r){return this.request(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}async get(e){return this.request(e,{method:"GET"})}async postFormData(e,r){return this.request(e,{method:"POST",body:r})}}class o{constructor(){this.client=new i}async translateFrame(e){let r=new FormData;r.append("file",e);try{return await this.client.postFormData("/api/v1/ml/predict/upload",r)}catch(e){throw console.error("Translation error:",e),Error(e instanceof Error?e.message:"Translation failed")}}async healthCheck(){try{return await this.client.get("/api/v1/ml/health")}catch{throw Error("Health check failed")}}async getModelInfo(){try{return await this.client.get("/api/v1/ml/model/info")}catch{throw Error("Failed to get model info")}}}let c=new o;function d(){let[e,r]=(0,n.useState)(!1),[t,s]=(0,n.useState)(!1),[a,l]=(0,n.useState)(null);return(0,n.useRef)(null),{isConnected:e,isChecking:t,lastCheck:a,checkConnection:(0,n.useCallback)(async()=>{try{s(!0),await c.healthCheck(),r(!0),l(new Date)}catch{r(!1)}finally{s(!1)}},[])}}class u{constructor(e){this.baseUrl="http://localhost:8000/api/v1/gamification",this.getAuthHeaders=e||(()=>Promise.resolve({}))}async getUserProfile(){try{let e=await this.getAuthHeaders(),r=await fetch(`${this.baseUrl}/user/profile`,{method:"GET",headers:{"Content-Type":"application/json",...e}});if(!r.ok)throw Error(`HTTP error! status: ${r.status}`);return(await r.json()).profile}catch(e){throw console.error("Error getting user profile:",e),e}}async getGameLevels(){try{let e=await this.getAllLetters();if(0===e.length)throw Error("No hay letras disponibles en el sistema");let r=1;try{r=(await this.getUserProfile()).current_level||1,console.log("[LEVELS] User current level:",r)}catch(e){console.warn("[LEVELS] Could not get user profile, defaulting to level 1:",e)}let t={easy:["SOL","MAR","PAN","CASA","MESA","AGUA","LUNA","GATO","PERRO","AMOR","MAM\xc1","PAP\xc1","NI\xd1O","NI\xd1A"],medium:["ESCUELA","FAMILIA","HERMANO","COMIDA","TRABAJO","SALUD","CIUDAD","AMIGO","TIEMPO","DINERO","VENTANA","PUERTA"],hard:["COMPUTADORA","UNIVERSIDAD","COMUNICACI\xd3N","DESARROLLO","TECNOLOG\xcdA","OPORTUNIDAD","EXPERIENCIA","CONOCIMIENTO"]},s=[{id:1,name:"Palabras B\xe1sicas",description:"Palabras simples de 3-5 letras",difficulty:"easy",unlocked:r>=1,completed:r>1,stars:0,words_length:[3,5],time_limit:45,lives:5,points_multiplier:1,words:t.easy.filter(r=>r.split("").every(r=>e.some(e=>e.letter===r))).slice(0,8)},{id:2,name:"Palabras Intermedias",description:"Palabras de 6-8 letras",difficulty:"medium",unlocked:r>=2,completed:r>2,stars:0,words_length:[6,8],time_limit:60,lives:4,points_multiplier:1.5,words:t.medium.filter(r=>r.split("").every(r=>e.some(e=>e.letter===r))).slice(0,6)},{id:3,name:"Palabras Avanzadas",description:"Palabras largas y complejas",difficulty:"hard",unlocked:r>=3,completed:r>3,stars:0,words_length:[9,15],time_limit:90,lives:3,points_multiplier:2,words:t.hard.filter(r=>r.split("").every(r=>e.some(e=>e.letter===r))).slice(0,4)}].filter(e=>e.words.length>0);return console.log("[LEVELS] Generated levels:",s.map(e=>({id:e.id,name:e.name,unlocked:e.unlocked,completed:e.completed}))),{levels:s,total_levels:s.length}}catch(r){console.error("Error fetching game levels:",r);let e=[{id:1,name:"Palabras B\xe1sicas",description:"Nivel de prueba con palabras simples",difficulty:"easy",unlocked:!0,completed:!1,stars:0,words_length:[3,5],time_limit:45,lives:5,points_multiplier:1,words:["SOL","MAR","PAN","CASA","MESA"]}];return{levels:e,total_levels:e.length}}}async startGameSession(e,r){try{console.log("[GAMIFICATION_SERVICE] Starting game session:",{levelId:e,userId:r});let t=await this.getAuthHeaders();console.log("[GAMIFICATION_SERVICE] Auth headers:",t);let s=await fetch(`${this.baseUrl}/game/start`,{method:"POST",headers:{"Content-Type":"application/json",...t},body:JSON.stringify({session_type:"practice",user_id:r})});if(console.log("[GAMIFICATION_SERVICE] Response status:",s.status),!s.ok){let e=await s.text();throw console.error("[GAMIFICATION_SERVICE] Response error:",e),Error(`HTTP error! status: ${s.status}`)}let a=await s.json();if(console.log("[GAMIFICATION_SERVICE] Response data:",a),!a.session)throw console.error("Backend did not return a session object:",a),Error("Backend did not return a valid session");let n=a.session.id||a.session.session_id;if(!n)throw console.error("Backend session has no ID:",a.session),Error("Backend did not return a valid session ID");return console.log("[GAMIFICATION_SERVICE] ✅ Session started successfully with ID:",n),{session_id:n,level_id:e,user_id:r,started_at:a.session.started_at||new Date().toISOString(),status:"active",current_word_index:0,score:0,lives_remaining:a.session.lives_remaining||5}}catch(e){throw console.error("Error starting game session:",e),e}}async endGameSession(e,r,t=!1){try{console.log("[GAMIFICATION_SERVICE] Ending game session:",{sessionId:e,finalScore:r,completed:t});let s=await this.getAuthHeaders();console.log("[GAMIFICATION_SERVICE] Auth headers for end:",s);let a=await fetch(`${this.baseUrl}/game/end`,{method:"POST",headers:{"Content-Type":"application/json",...s},body:JSON.stringify({session_id:e,final_score:r})});if(console.log("[GAMIFICATION_SERVICE] End response status:",a.status),!a.ok){let e=await a.text();throw console.error("[GAMIFICATION_SERVICE] End response error:",e),Error(`HTTP error! status: ${a.status}`)}let n=await a.json();return console.log("[GAMIFICATION_SERVICE] Game ended successfully:",n),n}catch(e){throw console.error("[GAMIFICATION_SERVICE] Error ending game session:",e),e}}async recordAttempt(e){try{console.log("[GAMIFICATION_SERVICE] \uD83D\uDCDD Enviando intento al backend:",{target_word:e.target_word,predicted_word:e.predicted_word,is_correct:e.is_correct});let r=await fetch(`${this.baseUrl}/game/attempt`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e.session_id,letter_id:this.getLetterIdFromName(e.target_letter),is_correct:e.is_correct,time_taken:e.time_taken,confidence_score:e.confidence,target_word:e.target_word,predicted_word:e.predicted_word})});if(!r.ok){let e=await r.text();throw console.error("[GAMIFICATION_SERVICE] Error response:",e),Error(`HTTP error! status: ${r.status}`)}return await r.json()}catch(e){throw console.error("Error recording attempt:",e),e}}getLetterIdFromName(e){return({A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:10,K:11,L:12,M:13,N:14,O:15,P:16,Q:17,R:18,S:19,T:20,U:21,V:22,W:23,X:24,Y:25,Z:26})[e.toUpperCase()]||1}async getAllLetters(){try{let e=await fetch(`${this.baseUrl}/letters`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return(await e.json()).letters||[]}catch(e){return console.error("Error fetching letters:",e),[]}}async getRandomLetters(e=5){try{let r=await fetch(`${this.baseUrl}/letters/random/${e}`);if(!r.ok)throw Error(`HTTP error! status: ${r.status}`);return(await r.json()).letters||[]}catch(e){return console.error("Error fetching random letters:",e),[]}}async getChallenges(){try{let e=await fetch(`${this.baseUrl}/challenges`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return(await e.json()).challenges||[]}catch(e){return console.error("Error fetching challenges:",e),[]}}async getChallengesByType(e){try{let r=await fetch(`${this.baseUrl}/challenges/type/${e}`);if(!r.ok)throw Error(`HTTP error! status: ${r.status}`);return(await r.json()).challenges||[]}catch(e){return console.error("Error fetching challenges by type:",e),[]}}async getChallengesByDifficulty(e){try{let r=await fetch(`${this.baseUrl}/challenges/difficulty/${e}`);if(!r.ok)throw Error(`HTTP error! status: ${r.status}`);return(await r.json()).challenges||[]}catch(e){return console.error("Error fetching challenges by difficulty:",e),[]}}async getRandomChallenge(){try{let e=await fetch(`${this.baseUrl}/challenges/random`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return(await e.json()).challenge||null}catch(e){return console.error("Error fetching random challenge:",e),null}}async completeChallenge(e,r=100){try{let t=await fetch(`${this.baseUrl}/challenges/${e}/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:r})});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(e){throw console.error("Error completing challenge:",e),e}}async getLeaderboard(){try{let e=await fetch(`${this.baseUrl}/leaderboard`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return(await e.json()).leaderboard||[]}catch(e){return console.error("Error fetching leaderboard:",e),[]}}async getStats(){try{let e=await fetch(`${this.baseUrl}/stats`);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching stats:",e),{total_challenges:0,challenges_by_difficulty:{},challenges_by_type:{},max_points_available:0}}}}new u;let m=e=>new u(e);var h=t(16396);let g=async()=>{try{let{data:{session:e},error:r}=await h.N.auth.getSession();if(r)return console.error("Error getting session for auth headers:",r),{};if(e?.access_token)return{Authorization:`Bearer ${e.access_token}`};return{}}catch(e){return console.error("Error creating auth headers:",e),{}}},f={currentWordIndex:0,score:0,lives:5,timeRemaining:30,correctWords:[],wrongWords:[],streak:0};function x(){let{user:e}=(0,s.A)(),r=m(g),[t,a]=(0,n.useState)("menu"),[l,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(f),[h,x]=(0,n.useState)([]),[p,v]=(0,n.useState)([]),[b,w]=(0,n.useState)(null),[E,N]=(0,n.useState)(null),[j,y]=(0,n.useState)(!1),[A,C]=(0,n.useState)(null),I=(0,n.useRef)(null),_=(0,n.useRef)([]),O=(0,n.useCallback)(()=>{I.current&&clearInterval(I.current),I.current=setInterval(()=>{u(e=>e.timeRemaining<=1?{...e,timeRemaining:0}:{...e,timeRemaining:e.timeRemaining-1})},1e3)},[]),T=(0,n.useCallback)(()=>{I.current&&(clearInterval(I.current),I.current=null)},[]),M=(0,n.useCallback)((e,r,t)=>{if(!o){console.warn("[GAME_MODE] No hay sesi\xf3n activa para acumular intento");return}let s={targetWord:e,predictedWord:r,isCorrect:t,timestamp:Date.now(),wordIndex:d.currentWordIndex};_.current.push(s),console.log(`[GAME_MODE] 📦 INTENTO ACUMULADO: ${e} → ${r} (${t?"✓":"✗"})`),console.log(`[GAME_MODE] 📋 Total intentos acumulados: ${_.current.length}`)},[o,d.currentWordIndex]),k=(0,n.useCallback)(async()=>{if(!o||0===_.current.length){console.log("[GAME_MODE] \uD83D\uDCED Sin intentos pendientes para enviar");return}let e=_.current;console.log(`[GAME_MODE] 🚀 ENVIANDO LOTE DE ${e.length} INTENTOS AL BACKEND...`);try{for(let[t,s]of e.entries())console.log(`[GAME_MODE] 📝 Enviando intento ${t+1}/${e.length}: ${s.targetWord} → ${s.predictedWord}`),await r.recordAttempt({session_id:o.session_id,target_letter:s.targetWord.charAt(0)||"A",predicted_letter:s.predictedWord.charAt(0)||"A",is_correct:s.isCorrect,confidence:.95,time_taken:1e3,word_index:s.wordIndex,target_word:s.targetWord,predicted_word:s.predictedWord}),await new Promise(e=>setTimeout(e,100));console.log(`[GAME_MODE] ✅ TODOS LOS INTENTOS ENVIADOS EXITOSAMENTE (${e.length})`),_.current=[]}catch(e){console.error(`[GAME_MODE] ❌ ERROR ENVIANDO LOTE DE INTENTOS:`,e)}},[o,r]),S=(0,n.useCallback)(async()=>{y(!0),C(null);try{let e=await r.getGameLevels();x(e.levels)}catch(e){C(e instanceof Error?e.message:"Error loading levels")}finally{y(!1)}},[r]),R=(0,n.useCallback)(async e=>{let r=h.find(r=>r.id===e);if(!r){C("Level not found");return}i(r),v(r.words),a("level-select")},[h]),D=(0,n.useCallback)(async t=>{y(!0),C(null);try{console.log("[GAME_MODE] Starting game with levelId:",t);let s=h.find(e=>e.id===t);if(!s)throw console.error("[GAME_MODE] Level not found. Available levels:",h.map(e=>({id:e.id,name:e.name}))),Error(`Level ${t} not found`);console.log("[GAME_MODE] Found level:",s);let n=await r.startGameSession(t,e?.id);_.current=[],i(s),c(n),v(s.words),w(s.words[0]||null),u({...f,lives:s.lives,timeRemaining:s.time_limit}),a("playing"),O()}catch(e){C(e instanceof Error?e.message:"Error starting game")}finally{y(!1)}},[h,O,r,e?.id]),G=(0,n.useCallback)(()=>{"playing"===t&&(T(),a("paused"))},[t,T]),$=(0,n.useCallback)(()=>{"paused"===t&&(O(),a("playing"))},[t,O]),P=(0,n.useCallback)(()=>{if(!p.length)return;u(e=>{let r=e.currentWordIndex+1;return r>=p.length?e:{...e,currentWordIndex:r,timeRemaining:l?.time_limit||30}});let e=d.currentWordIndex+1;e<p.length?w(p[e]):setTimeout(()=>a("completed"),0)},[p,l,d.currentWordIndex]),L=(0,n.useCallback)(e=>{if(l&&b){if(d.lives<=0||"playing"!==t){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO respuesta correcta - Juego inactivo:",{currentLives:d.lives,gameState:t});return}console.log("[GAME_MODE] \uD83C\uDFAF PROCESANDO RESPUESTA CORRECTA:",{word:e,currentWord:b}),M(b,e,!0),u(r=>({...r,score:r.score+100*l.points_multiplier*(r.streak+1),correctWords:[...r.correctWords,e],streak:r.streak+1})),P()}},[l,b,P,M,d.lives,t]),U=(0,n.useCallback)(e=>{if(!b)return;if(d.lives<=0){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO respuesta incorrecta - Sin vidas restantes:",{currentLives:d.lives,gameState:t});return}console.log("[GAME_MODE] \uD83D\uDCA5 PROCESANDO RESPUESTA INCORRECTA:",{currentWord:b,attemptedWord:e}),M(b,e||"",!1),u(r=>{let t=Math.max(0,r.lives-1),s={...r,lives:t,streak:0,timeRemaining:l?.time_limit||30};return e&&(s.wrongWords=[...r.wrongWords,e]),s});let r=Math.max(0,d.lives-1);console.log("[GAME_MODE] \uD83D\uDC94 Vidas despu\xe9s de respuesta incorrecta:",{currentLives:d.lives,newLives:r,willTriggerGameOver:r<=0}),r<=0?(console.log("[GAME_MODE] \uD83D\uDC80 DISPARADOR ACTIVADO - Sin vidas, terminando juego..."),setTimeout(()=>{console.log("[GAME_MODE] \uD83D\uDC80 EJECUTANDO setGameState(game-over)"),a("game-over")},0)):P()},[l,b,d.lives,P,M,t]),F=(0,n.useCallback)(async(e=!1)=>{if(console.log("[GAME_MODE] \uD83D\uDE80 endGame LLAMADO:",{completed:e,currentState:t,currentSession:o?.session_id,gameProgress:d.score}),!o){console.warn("[GAME_MODE] \uD83D\uDEE1️ IGNORANDO endGame - No hay sesi\xf3n activa");return}console.log("[GAME_MODE] \uD83C\uDFC1 TERMINANDO JUEGO:",{completed:e,currentState:t}),T(),console.log("[GAME_MODE] \uD83D\uDCE6 ENVIANDO intentos acumulados..."),await k();try{console.log("[GAME_MODE] \uD83D\uDCDD Finalizando sesi\xf3n:",o.session_id);let t=await r.endGameSession(o.session_id,d.score,e);console.log("[GAME_MODE] ✅ Sesi\xf3n finalizada exitosamente:",t),c(null)}catch(e){console.error("[GAME_MODE] ❌ Error ending game session:",e)}},[T,o,d.score,t,k,r]);return{gameState:t,currentLevel:l,currentSession:o,gameProgress:d,levels:h,currentWords:p,currentWord:b,currentChallenge:E,loadLevels:S,selectLevel:R,startGame:D,pauseGame:G,resumeGame:$,nextWord:P,processCorrectAnswer:L,processWrongAnswer:U,endGame:F,resetGame:(0,n.useCallback)(()=>{T(),a("menu"),i(null),c(null),u(f),v([]),w(null),N(null),C(null),_.current=[]},[T]),isLoading:j,error:A}}}};